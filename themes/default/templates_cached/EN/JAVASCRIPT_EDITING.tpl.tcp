<?php
return unserialize("a:6:{i:0;a:1:{i:0;a:5:{i:0;s:26:\"tcpfunc_JAVASCRIPT_EDITING\";i:1;a:0:{}i:2;i:1;i:3;s:0:\"\";i:4;s:0:\"\";}}i:1;a:0:{}i:2;s:18:\"JAVASCRIPT_EDITING\";i:3;N;i:4;N;i:5;s:44688:\"\$TPL_FUNCS['tcpfunc_JAVASCRIPT_EDITING']=\" echo \\\"\\\\\\\"use strict\\\\\\\";\\\\n\\\\n/* Form editing code (general\\\",\\n	',',\\n	\\\" may be used on many different kinds of form) */\\\\n\\\\n// ===========\\\\n// HTML EDITOR\\\\n// ===========\\\\n\\\\nif (typeof window.CKEDITOR=='undefined')\\\\n{\\\\n	window.CKEDITOR=null;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction wysiwyg_cookie_says_on()\\\\n{\\\\n	var cookie=read_cookie('use_wysiwyg');\\\\n	return ((cookie=='') || (cookie=='1')) && (browser_matches('wysiwyg') && ('\\\",\\n	ecv(\\\$cl,array(),0,\\\"MOBILE\\\",array()),\\n	\\\"'!='1'));\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction wysiwyg_on()\\\\n{\\\\n	return wysiwyg_cookie_says_on();\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction toggle_wysiwyg(name)\\\\n{\\\\n	if (!browser_matches('wysiwyg'))\\\\n	{\\\\n		window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"TOGGLE_WYSIWYG_ERROR\\\",array()),\\n	\\\"');\\\\n		return false;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	if (typeof window.do_ajax_request=='undefined') return false;\\\\n	if (typeof window.merge_text_nodes=='undefined') return false;\\\\n	if (typeof window.get_elements_by_class_name=='undefined') return false;\\\\n\\\\n	var is_wysiwyg_on=wysiwyg_on();\\\\n	if (is_wysiwyg_on)\\\\n	{\\\\n		window.fauxmodal_confirm(\\\\n			'\\\",\\n	ecv(\\\$cl,array(2),2,\\\"WHETHER_SAVE_WYSIWYG_SELECTION\\\",array()),\\n	\\\"'\\\",\\n	',',\\n	\\\"\\\\n			function(saving_cookies)\\\\n			{\\\\n				_toggle_wysiwyg(name\\\",\\n	',',\\n	\\\"saving_cookies);\\\\n			\\\",\\n	\\\"}\\\",\\n	',',\\n	\\\"\\\\n			'\\\",\\n	ecv(\\\$cl,array(2),2,\\\"REMEMBER_SETTING\\\",array()),\\n	\\\"'\\\\n		);\\\\n		return false;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	return _toggle_wysiwyg(name\\\",\\n	',',\\n	\\\"true);\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction _toggle_wysiwyg(name\\\",\\n	',',\\n	\\\"saving_cookies)\\\\n{\\\\n	var is_wysiwyg_on=wysiwyg_on();\\\\n\\\\n	if (saving_cookies)\\\\n	{\\\\n		set_cookie('use_wysiwyg'\\\",\\n	',',\\n	\\\"is_wysiwyg_on?'0':'1'\\\",\\n	',',\\n	\\\"3000);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	var forms=document.getElementsByTagName('form');\\\\n	var so=document.getElementById('post_special_options');\\\\n	var so2=document.getElementById('post_special_options2');\\\\n\\\\n	if (is_wysiwyg_on)\\\\n	{\\\\n		// Find if the WYSIWYG has anything in it - if not\\\",\\n	',',\\n	\\\" discard\\\\n		var all_empty=true\\\",\\n	',',\\n	\\\"myregexp=new RegExp(/((\\\\\\\\s)|(<p\\\\\\\\d*\\\\\\\\/>)|(<\\\\\\\\/p>)|(<p>)|(&nbsp;)|(<br[^>]*>))*/);\\\\n		for (var fid=0;fid<forms.length;fid++)\\\\n		{\\\\n			for (var counter=0;counter<forms[fid].elements.length;counter++)\\\\n			{\\\\n				var id=forms[fid].elements[counter].id;\\\\n				if (typeof window.wysiwyg_editors[id]!='undefined')\\\\n				{\\\\n					if (window.wysiwyg_editors[id].getData().replace(myregexp\\\",\\n	',',\\n	\\\"'')!='') all_empty=false;\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n		if (all_empty)\\\\n		{\\\\n			disable_wysiwyg(forms\\\",\\n	',',\\n	\\\"so\\\",\\n	',',\\n	\\\"so2\\\",\\n	',',\\n	\\\"true);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n		if ((typeof window.wysiwyg_original_comcode[id]=='undefined') || (window.wysiwyg_original_comcode[id].indexOf('&#8203;')!=-1) || (window.wysiwyg_original_comcode[id].indexOf('ocp_keep')!=-1))\\\\n		{\\\\n			disable_wysiwyg(forms\\\",\\n	',',\\n	\\\"so\\\",\\n	',',\\n	\\\"so2\\\",\\n	',',\\n	\\\"false);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n		{\\\\n			generate_question_ui(\\\\n				'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"DISCARD_WYSIWYG_CHANGES_NICE\\\",array()),\\n	\\\"'\\\",\\n	',',\\n	\\\"\\\\n				{cancel: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"'\\\",\\n	',',\\n	\\\"convert: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"DISCARD_WYSIWYG_CHANGES_LINE_CONVERT\\\",array()),\\n	\\\"'\\\",\\n	',',\\n	\\\"discard: '\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"DISCARD_WYSIWYG_CHANGES_LINE\\\",array()),\\n	\\\"'\\\",\\n	\\\"}\\\",\\n	',',\\n	\\\"\\\\n				'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"DISABLE_WYSIWYG\\\",array()),\\n	\\\"'\\\",\\n	',',\\n	\\\"\\\\n				'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"DISCARD_WYSIWYG_CHANGES\\\",array()),\\n	\\\"'\\\",\\n	',',\\n	\\\"\\\\n				function(prompt)\\\\n				{\\\\n					if ((!prompt) || (prompt.toLowerCase()=='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"'.toLowerCase()))\\\\n					{\\\\n						if (saving_cookies)\\\\n							set_cookie('use_wysiwyg'\\\",\\n	',',\\n	\\\"'1'\\\",\\n	',',\\n	\\\"3000);\\\\n						return false;\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n					var discard=(prompt.toLowerCase()=='\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"DISCARD_WYSIWYG_CHANGES_LINE\\\",array()),\\n	\\\"'.toLowerCase());\\\\n\\\\n					disable_wysiwyg(forms\\\",\\n	',',\\n	\\\"so\\\",\\n	',',\\n	\\\"so2\\\",\\n	',',\\n	\\\"discard);\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n	{\\\\n		enable_wysiwyg(forms\\\",\\n	',',\\n	\\\"so\\\",\\n	',',\\n	\\\"so2);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	return false;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction enable_wysiwyg(forms\\\",\\n	',',\\n	\\\"so\\\",\\n	',',\\n	\\\"so2)\\\\n{\\\\n	window.wysiwyg_on=function() { return true; \\\",\\n	\\\"}\\\",\\n	\\\";\\\\n\\\\n	for (var fid=0;fid<forms.length;fid++)\\\\n	{\\\\n		load_html_edit(forms[fid]\\\",\\n	',',\\n	\\\"true);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction disable_wysiwyg(forms\\\",\\n	',',\\n	\\\"so\\\",\\n	',',\\n	\\\"so2\\\",\\n	',',\\n	\\\"discard)\\\\n{\\\\n	for (var fid=0;fid<forms.length;fid++)\\\\n	{\\\\n		for (var counter=0;counter<forms[fid].elements.length;counter++)\\\\n		{\\\\n			var id=forms[fid].elements[counter].id;\\\\n			if (typeof window.wysiwyg_editors[id]!='undefined')\\\\n			{\\\\n				var textarea=forms[fid].elements[counter];\\\\n\\\\n				// Mark as non-WYSIWYG\\\\n				document.getElementById(id+'__is_wysiwyg').value='0';\\\\n				textarea.style.display='block';\\\\n				textarea.style.visibility='visible';\\\\n				textarea.disabled=false;\\\\n				textarea.readOnly=false;\\\\n\\\\n				// Unload editor\\\\n				var wysiwyg_data=window.wysiwyg_editors[id].getData();\\\\n				window.wysiwyg_editors[id].destroy();\\\\n				delete window.wysiwyg_editors[id];\\\\n\\\\n				// Comcode conversion\\\\n				if ((discard) && (window.wysiwyg_original_comcode[id]))\\\\n				{\\\\n					textarea.value=window.wysiwyg_original_comcode[id];\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n				{\\\\n					var url=maintain_theme_in_link('\\\",\\n	ecv(\\\$cl,array(2),0,\\\"FIND_SCRIPT_NOHTTP\\\",array(\\\"comcode_convert\\\")),\\n	\\\"?from_html=1'+keep_stub());\\\\n					if (window.location.href.indexOf('topics')!=-1) url+='&forum_db=1';\\\\n					var request=do_ajax_request(url\\\",\\n	',',\\n	\\\"false\\\",\\n	',',\\n	\\\"'data='+window.encodeURIComponent(wysiwyg_data.replace(new RegExp(String.fromCharCode(8203)\\\",\\n	',',\\n	\\\"'g')\\\",\\n	',',\\n	\\\"'')));\\\\n					if ((!request.responseXML) || (!request.responseXML.documentElement.getElementsByTagName('result')[0]))\\\\n					{\\\\n						textarea.value='[semihtml]'+wysiwyg_data+'[/semihtml]';\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n					{\\\\n						var result_tags=request.responseXML.documentElement.getElementsByTagName('result');\\\\n						var result=result_tags[0];\\\\n						textarea.value=merge_text_nodes(result.childNodes).replace(/\\\\\\\\s*\\\\\\\$/\\\",\\n	',',\\n	\\\"'');\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n					if ((textarea.value.indexOf('{\\\\\\\\\\\\\\\$\\\",\\n	',',\\n	\\\"page hint: no_wysiwyg\\\",\\n	\\\"}\\\",\\n	\\\"')==-1) && (textarea.value!='')) textarea.value+='{\\\\\\\\\\\\\\\$\\\",\\n	',',\\n	\\\"page hint: no_wysiwyg\\\",\\n	\\\"}\\\",\\n	\\\"';\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n				if (document.getElementById('toggle_wysiwyg_'+id))\\\\n					set_inner_html(document.getElementById('toggle_wysiwyg_'+id)\\\",\\n	',',\\n	\\\"'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"ENABLE_WYSIWYG\\\",array()),\\n	\\\"');\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	if (so) so.style.display='block';\\\\n	if (so2) so2.style.display='none';\\\\n\\\\n	window.wysiwyg_on=function() { return false; \\\",\\n	\\\"}\\\",\\n	\\\";\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nwindow.wysiwyg_editors={\\\",\\n	\\\"}\\\",\\n	\\\";\\\\nwindow.wysiwyg_original_comcode={\\\",\\n	\\\"}\\\",\\n	\\\";\\\\nfunction load_html_edit(posting_form\\\",\\n	',',\\n	\\\"ajax_copy)\\\\n{\\\\n	if ((!posting_form.method) || (posting_form.method.toLowerCase()!='post')) return;\\\\n\\\\n	if (!posting_form.elements['http_referer'])\\\\n	{\\\\n		var http_referer=document.createElement('input');\\\\n		http_referer.name='http_referer';\\\\n		http_referer.value=window.location.href;\\\\n		http_referer.setAttribute('type'\\\",\\n	',',\\n	\\\"'hidden');\\\\n		posting_form.appendChild(http_referer);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	if (typeof window.do_ajax_request=='undefined') return;\\\\n	if (typeof window.merge_text_nodes=='undefined') return;\\\\n	if (typeof window.CKEDITOR=='undefined') return;\\\\n	if (!browser_matches('wysiwyg')) return;\\\\n	if (!wysiwyg_on()) return;\\\\n\\\\n	var so=document.getElementById('post_special_options');\\\\n	var so2=document.getElementById('post_special_options2');\\\\n	if ((!posting_form.elements['post']) || (posting_form.elements['post'].className.indexOf('wysiwyg')!=-1))\\\\n	{\\\\n		if (so) so.style.display='none';\\\\n		if (so2) so2.style.display='block';\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	var counter\\\",\\n	',',\\n	\\\"count=0\\\",\\n	',',\\n	\\\"e\\\",\\n	',',\\n	\\\"indicator\\\",\\n	',',\\n	\\\"those_done=[]\\\",\\n	',',\\n	\\\"id;\\\\n	for (counter=0;counter<posting_form.elements.length;counter++)\\\\n	{\\\\n		e=posting_form.elements[counter];\\\\n		id=e.id;\\\\n\\\\n		if ((e.type=='textarea') && (e.className.indexOf('wysiwyg')!=-1) && (!is_comcode_xml(e)))\\\\n		{\\\\n			if (document.getElementById(id+'__is_wysiwyg'))\\\\n			{\\\\n				indicator=document.getElementById(id+'__is_wysiwyg');\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n			{\\\\n				indicator=document.createElement('input');\\\\n				indicator.setAttribute('type'\\\",\\n	',',\\n	\\\"'hidden');\\\\n				indicator.id=e.id+'__is_wysiwyg';\\\\n				indicator.name=e.name+'__is_wysiwyg';\\\\n				posting_form.appendChild(indicator);\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			indicator.value='1';\\\\n\\\\n			if (those_done[id]) continue;\\\\n			those_done[id]=1;\\\\n\\\\n			count++;\\\\n			if (document.getElementById('toggle_wysiwyg_'+id))\\\\n				set_inner_html(document.getElementById('toggle_wysiwyg_'+id)\\\",\\n	',',\\n	\\\"'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"DISABLE_WYSIWYG\\\",array()),\\n	\\\"');\\\\n\\\\n			window.wysiwyg_original_comcode[id]=e.value;\\\\n			if (!ajax_copy)\\\\n			{\\\\n				if ((typeof posting_form.elements[id+'_parsed']!='undefined') && (posting_form.elements[id+'_parsed'].value!='') && ((e.defaultValue==''/*IE bug*/) || (e.defaultValue==e.value))) // The extra conditionals are for if back button used\\\\n					e.value=posting_form.elements[id+'_parsed'].value;\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n			{\\\\n				var url=maintain_theme_in_link('\\\",\\n	ecv(\\\$cl,array(2),0,\\\"FIND_SCRIPT_NOHTTP\\\",array(\\\"comcode_convert\\\")),\\n	\\\"?semihtml=1&from_html=0'+keep_stub());\\\\n				if (window.location.href.indexOf('topics')!=-1) url+='&forum_db=1';\\\\n				var request=do_ajax_request(url\\\",\\n	',',\\n	\\\"false\\\",\\n	',',\\n	\\\"'data='+window.encodeURIComponent(posting_form.elements[counter].value.replace(new RegExp(String.fromCharCode(8203)\\\",\\n	',',\\n	\\\"'g')\\\",\\n	',',\\n	\\\"'').replace('{'+'\\\\\\\$\\\",\\n	',',\\n	\\\"page hint: no_wysiwyg\\\",\\n	\\\"}\\\",\\n	\\\"'\\\",\\n	',',\\n	\\\"'')));\\\\n				if (!request.responseXML)\\\\n				{\\\\n					posting_form.elements[counter].value='';\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n				{\\\\n					var result_tags=request.responseXML.documentElement.getElementsByTagName('result');\\\\n					if ((!result_tags) || (result_tags.length==0))\\\\n					{\\\\n						posting_form.elements[counter].value='';\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n					{\\\\n						var result=result_tags[0];\\\\n						posting_form.elements[counter].value=merge_text_nodes(result.childNodes);\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			window.setTimeout(function(e\\\",\\n	',',\\n	\\\"id) {\\\\n				return function() {\\\\n					window.wysiwyg_editors[id]=wysiwyg_editor_init_for(e);\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"(e\\\",\\n	',',\\n	\\\"id)\\\",\\n	',',\\n	\\\"1000);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	if (count==0) return;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction wysiwyg_editor_init_for(element)\\\\n{\\\\n	var page_stylesheets=[];\\\\n	if (!document) return;\\\\n	var linked_sheets=document.getElementsByTagName('link');\\\\n	for (var counter=0;counter<linked_sheets.length;counter++)\\\\n	{\\\\n		if (linked_sheets[counter].getAttribute('rel')=='stylesheet')\\\\n			page_stylesheets.push(linked_sheets[counter].getAttribute('href'));\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	// Fiddly procedure to find our colour\\\\n	var test_div=document.createElement('div');\\\\n	document.body.appendChild(test_div);\\\\n	test_div.className='wysiwyg_toolbar_color_finder';\\\\n	var matches;\\\\n	var wysiwyg_color=abstract_get_computed_style(test_div\\\",\\n	',',\\n	\\\"'color');\\\\n	test_div.parentNode.removeChild(test_div);\\\\n	matches=wysiwyg_color.match(/^rgb\\\\\\\\((\\\\\\\\d+)\\\",\\n	',',\\n	\\\"\\\\\\\\s*(\\\\\\\\d+)\\\",\\n	',',\\n	\\\"\\\\\\\\s*(\\\\\\\\d+)\\\\\\\\)\\\\\\\$/\\\",\\n	',',\\n	\\\"matches);\\\\n	if (matches)\\\\n	{\\\\n		wysiwyg_color='#';\\\\n		var hex;\\\\n		hex=(window.parseInt(matches[1]).toString(16))+'';\\\\n		if (hex.length==1) hex='0'+hex;\\\\n		wysiwyg_color+=hex;\\\\n		hex=(window.parseInt(matches[2]).toString(16))+'';\\\\n		if (hex.length==1) hex='0'+hex;\\\\n		wysiwyg_color+=hex;\\\\n		hex=(window.parseInt(matches[3]).toString(16))+'';\\\\n		if (hex.length==1) hex='0'+hex;\\\\n		wysiwyg_color+=hex;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	// CKEditor doesn't allow low saturation\\\",\\n	',',\\n	\\\" so raise up if we need to\\\\n	matches=wysiwyg_color.match(/^#([0-4])(.)([0-4])(.)([0-4])(.)\\\\\\\$/);\\\\n	if (matches)\\\\n	{\\\\n		wysiwyg_color='#';\\\\n		wysiwyg_color+=(window.parseInt(matches[1])+4)+matches[2];\\\\n		wysiwyg_color+=(window.parseInt(matches[3])+4)+matches[4];\\\\n		wysiwyg_color+=(window.parseInt(matches[5])+4)+matches[6];\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	\\\",\\n	\\\"// Carefully work out toolbar\\\\nvar precision_editing=((typeof window.take_errors!='undefined') && window.take_errors) || (get_elements_by_class_name(document.body\\\",\\n	',',\\n	\\\"'comcode_button_box').length>1); // Look to see if this Comcode button is here as a hint whether we are doing an advanced editor. Unfortunately we cannot put contextual Tempcode inside a Javascript file\\\",\\n	',',\\n	\\\" so this trick is needed.\\\\nvar toolbar=[];\\\\nif (precision_editing)\\\\n	toolbar.push(['Source'\\\",\\n	',',\\n	\\\"'-']);\\\\ntoolbar.push(['Cut'\\\",\\n	',',\\n	\\\"'Copy'\\\",\\n	',',\\n	\\\"'Paste'\\\",\\n	',',\\n	\\\"precision_editing?'PasteText':null\\\",\\n	',',\\n	\\\"precision_editing?'PasteFromWord':null\\\",\\n	((\\\"\\\".\\\"\\\"==\\\"1\\\")?(','.\\\"'-'\\\".','.\\\"'SpellChecker'\\\".','.\\\" 'Scayt'\\\"):''),\\n	\\\"]);\\\\ntoolbar.push(['Undo'\\\",\\n	',',\\n	\\\"'Redo'\\\",\\n	',',\\n	\\\"precision_editing?'-':null\\\",\\n	',',\\n	\\\"precision_editing?'Find':null\\\",\\n	',',\\n	\\\"precision_editing?'Replace':null\\\",\\n	',',\\n	\\\"'-'\\\",\\n	',',\\n	\\\"precision_editing?'SelectAll':null\\\",\\n	',',\\n	\\\"'RemoveFormat']);\\\\ntoolbar.push(['Link'\\\",\\n	',',\\n	\\\"'Unlink']);\\\\ntoolbar.push(precision_editing?'/':'-');\\\\nvar formatting=['Bold'\\\",\\n	',',\\n	\\\"'Italic'\\\",\\n	',',\\n	\\\"'Strike'\\\",\\n	',',\\n	\\\"'-'\\\",\\n	',',\\n	\\\"precision_editing?'Subscript':null\\\",\\n	',',\\n	\\\"precision_editing?'Superscript':null];\\\\ntoolbar.push(formatting);\\\\ntoolbar.push(['NumberedList'\\\",\\n	',',\\n	\\\"'BulletedList'\\\",\\n	',',\\n	\\\"precision_editing?'-':null\\\",\\n	',',\\n	\\\"precision_editing?'Outdent':null\\\",\\n	',',\\n	\\\"precision_editing?'Indent':null]);\\\\nif (precision_editing)\\\\n	toolbar.push(['JustifyLeft'\\\",\\n	',',\\n	\\\"'JustifyCenter'\\\",\\n	',',\\n	\\\"'JustifyRight'\\\",\\n	',',\\n	\\\"precision_editing?'JustifyBlock':null]);\\\\ntoolbar.push([precision_editing?'ocportal_image':null\\\",\\n	',',\\n	\\\"'Table']);\\\\nif (precision_editing)\\\\n	toolbar.push('/');\\\\ntoolbar.push(['Format'\\\",\\n	',',\\n	\\\"'Font'\\\",\\n	',',\\n	\\\"'FontSize']);\\\\ntoolbar.push(['TextColor']);\\\\nif (precision_editing)\\\\n	toolbar.push(['Maximize'\\\",\\n	',',\\n	\\\" 'ShowBlocks']);\\\\nif (precision_editing)\\\\n	toolbar.push(['HorizontalRule'\\\",\\n	',',\\n	\\\"'SpecialChar']);\\\\nvar use_ocportal_toolbar=true;\\\\nif (use_ocportal_toolbar)\\\\n	toolbar.push(['ocportal_block'\\\",\\n	',',\\n	\\\"'ocportal_comcode'\\\",\\n	',',\\n	\\\"precision_editing?'ocportal_page':null\\\",\\n	',',\\n	\\\"'ocportal_quote'\\\",\\n	',',\\n	\\\"precision_editing?'ocportal_box':null\\\",\\n	',',\\n	\\\"'ocportal_code']);\\\\n\\\\nvar editor_settings={\\\\n	enterMode : window.CKEDITOR.ENTER_BR\\\",\\n	',',\\n	\\\"\\\\n	shiftEnterMode : window.CKEDITOR.ENTER_P\\\",\\n	',',\\n	\\\"\\\\n	uiColor : wysiwyg_color\\\",\\n	',',\\n	\\\"\\\\n	fontSize_sizes : '0.6em;0.85em;1em;1.1em;1.2em;1.3em;1.4em;1.5em;1.6em;1.7em;1.8em;2em'\\\",\\n	',',\\n	\\\"\\\\n	removePlugins: ''\\\",\\n	',',\\n	\\\"\\\\n	//removePlugins: 'contextmenu\\\",\\n	',',\\n	\\\"liststyle\\\",\\n	',',\\n	\\\"tableresize\\\",\\n	',',\\n	\\\"tabletools'\\\",\\n	',',\\n	\\\" to restore the native context menu\\\",\\n	',',\\n	\\\" with spellcheck/working-copy&paste\\\\n	extraPlugins: ''+(use_ocportal_toolbar?'ocportal':'')\\\",\\n	',',\\n	\\\"\\\\n	removeButtons: 'PasteFromWord'\\\",\\n	',',\\n	\\\" // Paste from Word doesn't actually need separate button (http://dev.ckeditor.com/ticket/12908#comment:2)\\\\n	customConfig : ''\\\",\\n	',',\\n	\\\"\\\\n	bodyId : 'htmlarea'\\\",\\n	',',\\n	\\\"\\\\n	baseHref : get_base_url()+'/'\\\",\\n	',',\\n	\\\"\\\\n	linkShowAdvancedTab : \\\",\\n	ecv(\\\$cl,array(),0,\\\"?\\\",array(\\\"0\\\",\\\"false\\\",\\\"true\\\")),\\n	',',\\n	\\\"\\\\n	imageShowAdvancedTab : \\\",\\n	ecv(\\\$cl,array(),0,\\\"?\\\",array(\\\"0\\\",\\\"false\\\",\\\"true\\\")),\\n	',',\\n	\\\"\\\\n	imageShowLinkTab : \\\",\\n	ecv(\\\$cl,array(),0,\\\"?\\\",array(\\\"0\\\",\\\"false\\\",\\\"true\\\")),\\n	',',\\n	\\\"\\\\n	imageShowSizing : \\\",\\n	ecv(\\\$cl,array(),0,\\\"?\\\",array(\\\"0\\\",\\\"false\\\",\\\"true\\\")),\\n	',',\\n	\\\"\\\\n	autoUpdateElement : true\\\",\\n	',',\\n	\\\"\\\\n	contentsCss : page_stylesheets\\\",\\n	',',\\n	\\\"\\\\n	cssStatic : css\\\",\\n	',',\\n	\\\"\\\\n	startupOutlineBlocks : true\\\",\\n	',',\\n	\\\"\\\\n	language : (window.ocp_lang)?ocp_lang.toLowerCase():'en'\\\",\\n	',',\\n	\\\"\\\\n	emailProtection : false\\\",\\n	',',\\n	\\\"\\\\n	resize_enabled : true\\\",\\n	',',\\n	\\\"\\\\n	width : (find_width(element)-15)\\\",\\n	',',\\n	\\\"\\\\n	height : (window.location.href.indexOf('cms_comcode_pages')==-1)?250:500\\\",\\n	',',\\n	\\\"\\\\n	\\\",\\n	((ecv(\\\$cl,array(),0,\\\"NOT\\\",array(\\\"\\\")).\\\"\\\"==\\\"1\\\")?(\\\"\\\\n		disableNativeSpellChecker : false\\\".','.\\\"\\\\n	\\\"):''),\\n	\\\"\\\\n	toolbar : toolbar\\\",\\n	',',\\n	\\\"\\\\n	allowedContent: true\\\\n\\\",\\n	\\\"}\\\",\\n	\\\";\\\\n\\\",\\n	\\\"\\\\n\\\\n	if (typeof window.CKEDITOR.instances[element.id]!='undefined' && window.CKEDITOR.instances[element.id]) delete window.CKEDITOR.instances[element.id]; // Workaround \\\\\\\"The instance \\\\\\\"xxx\\\\\\\" already exists\\\\\\\" error in Google Chrome\\\\n	var editor=window.CKEDITOR.replace(element.id\\\",\\n	',',\\n	\\\"editor_settings);\\\\n	if (!editor) return; // Not supported on this platform\\\\n\\\\n	linked_sheets=document.getElementsByTagName('style');\\\\n	var css='';\\\\n	css+='body { width: 100%; min-height: 140px; \\\",\\n	\\\"}\\\",\\n	\\\"'; // IE9 selectability fix\\\\n	css+=\\\\\\\"#screen_title { display: block !important \\\",\\n	\\\"}\\\",\\n	\\\"\\\\\\\";\\\\n	css+=\\\\\\\".MsoNormal { margin: 0; \\\",\\n	\\\"}\\\",\\n	\\\"\\\\\\\";\\\\n	css+='kbd.ocp_keep\\\",\\n	',',\\n	\\\"kbd.ocp_keep_block { background-color: #BABAFF; \\\",\\n	\\\"}\\\",\\n	\\\"';\\\\n	css+='input.ocp_keep_ui_controlled\\\",\\n	',',\\n	\\\"input.ocp_keep_ui_controlled:focus { border:1px dotted; text-align: center; color: buttontext; background: buttonface; max-width: 270px; \\\",\\n	\\\"}\\\",\\n	\\\"';\\\\n	css+='input.ocp_keep_ui_controlled::selection { background: buttonface; \\\",\\n	\\\"}\\\",\\n	\\\"';\\\\n	css+='input.ocp_keep_ui_controlled::-moz-selection { background: buttonface; \\\",\\n	\\\"}\\\",\\n	\\\"';\\\\n	css+='.comcode_fake_table > div\\\",\\n	',',\\n	\\\" .fp_col_block { outline: 1px dotted; margin: 1px 0; \\\",\\n	\\\"}\\\",\\n	\\\"';\\\\n	for (counter=0;counter<linked_sheets.length;counter++)\\\\n	{\\\\n		css+=get_inner_html(linked_sheets[counter]);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	window.CKEDITOR.addCss(css);\\\\n\\\\n	// Change some CKEditor defaults\\\\n	window.CKEDITOR.on('dialogDefinition'\\\",\\n	',',\\n	\\\"function(ev) {\\\\n		var dialogName=ev.data.name;\\\\n		var dialogDefinition=ev.data.definition;\\\\n\\\\n		if (dialogName=='table') {\\\\n			var info=dialogDefinition.getContents('info');\\\\n\\\\n			info.get('txtWidth')['default']='100%';\\\\n			info.get('txtBorder')['default']='0';\\\\n			info.get('txtBorder')['default']='0';\\\\n			info.get('txtCellSpace')['default']='0';\\\\n			info.get('txtCellPad')['default']='0';\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\");\\\\n	if (document.getElementById('attachment_store'))\\\\n		window.lang_PREFER_OCP_ATTACHMENTS='\\\",\\n	ecv(\\\$cl,array(2),2,\\\"javascript:PREFER_OCP_ATTACHMENTS\\\",array()),\\n	\\\"';\\\\n\\\\n	/*window.setTimeout( function() {\\\\n		window.scrollTo(0\\\",\\n	',',\\n	\\\"0); // Otherwise jumps to last editor\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" \\\",\\n	',',\\n	\\\" 500);*/\\\\n\\\\n	editor.on('key'\\\",\\n	',',\\n	\\\" function (event) {\\\\n		if (typeof element.externalonKeyPress!='undefined')\\\\n		{\\\\n			element.value=editor.getData();\\\\n			element.externalonKeyPress(event\\\",\\n	',',\\n	\\\"element);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" );\\\\n\\\\n	editor.on('instanceReady'\\\",\\n	',',\\n	\\\" function (event) {\\\\n		find_tags_in_editor(editor\\\",\\n	',',\\n	\\\"element);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" );\\\\n	window.setInterval(function() {\\\\n		if (is_wysiwyg_field(element))\\\\n			find_tags_in_editor(editor\\\",\\n	',',\\n	\\\"element);\\\\n	\\\",\\n	\\\"}\\\",\\n	',',\\n	\\\" 1000);\\\\n\\\\n	// Weird issues in Chrome cutting+pasting blocks etc\\\\n	editor.on('paste'\\\",\\n	',',\\n	\\\" function (event) {\\\\n		if (event.data.html)\\\\n		{\\\\n			event.data.html=event.data.html.replace(/<meta charset=\\\\\\\"utf-8\\\\\\\">/g\\\",\\n	',',\\n	\\\"'');\\\\n			event.data.html=event.data.html.replace(/<br class=\\\\\\\"Apple-interchange-newline\\\\\\\">/g\\\",\\n	',',\\n	\\\"'<br>');\\\\n			event.data.html=event.data.html.replace(/<div style=\\\\\\\"text-align: center;\\\\\\\"><font class=\\\\\\\"Apple-style-span\\\\\\\" face=\\\\\\\"'Lucida Grande'\\\\\\\"><span class=\\\\\\\"Apple-style-span\\\\\\\" style=\\\\\\\"font-size: 11px; white-space: pre;\\\\\\\"><br><\\\\\\\\/span><\\\\\\\\/font><\\\\\\\\/div>\\\\\\\$/\\\",\\n	',',\\n	\\\"'<br><br>');\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" );\\\\n\\\\n	/*editor.on('instanceReady'\\\",\\n	',',\\n	\\\"function(ev) Does not work\\\\n	{\\\\n		var editor=ev.editor;\\\\n		if (typeof window.initialise_dragdrop_upload!='undefined') initialise_dragdrop_upload(element.id\\\",\\n	',',\\n	\\\"element.id\\\",\\n	',',\\n	\\\"editor.element.\\\\\\\$.document);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\");*/\\\\n\\\\n	return editor;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction find_tags_in_editor(editor\\\",\\n	',',\\n	\\\"element)\\\\n{\\\\n	if (!editor.document) return;\\\\n	if (typeof editor.document.\\\\\\\$=='undefined') return;\\\\n	if (!editor.document.\\\\\\\$) return;\\\\n\\\\n	var comcodes=get_elements_by_class_name(editor.document.\\\\\\\$.getElementsByTagName('body')[0]\\\",\\n	',',\\n	\\\"'(ocp_keep|ocp_keep_block|ocp_keep_ui_controlled)');\\\\n\\\\n	for (var i=0;i<comcodes.length;i++)\\\\n	{\\\\n		if (!comcodes[i].onmouseout)\\\\n		{\\\\n			comcodes[i].orig_title=comcodes[i].title;\\\\n			comcodes[i].onmouseout=function(event) {\\\\n				if (typeof event=='undefined') var event=editor.window.\\\\\\\$.event;\\\\n\\\\n				var eventCopy={\\\",\\n	\\\"}\\\",\\n	\\\";\\\\n				if (event)\\\\n				{\\\\n					if (event.pageX) eventCopy.pageX=3000;\\\\n					if (event.clientX) eventCopy.clientX=3000;\\\\n					if (event.pageY) eventCopy.pageY=3000;\\\\n					if (event.clientY) eventCopy.clientY=3000;\\\\n\\\\n					if (typeof window.deactivate_tooltip!='undefined') deactivate_tooltip(this\\\",\\n	',',\\n	\\\"eventCopy);\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\";\\\\n			comcodes[i].onmousemove=function(event) {\\\\n				if (typeof event=='undefined') var event=editor.window.\\\\\\\$.event;\\\\n\\\\n				var eventCopy={\\\",\\n	\\\"}\\\",\\n	\\\";\\\\n				if (event)\\\\n				{\\\\n					if (event.pageX) eventCopy.pageX=3000;\\\\n					if (event.clientX) eventCopy.clientX=3000;\\\\n					if (event.pageY) eventCopy.pageY=3000;\\\\n					if (event.clientY) eventCopy.clientY=3000;\\\\n\\\\n					if (typeof window.activate_tooltip!='undefined')\\\\n					{\\\\n						reposition_tooltip(this\\\",\\n	',',\\n	\\\"eventCopy);\\\\n						this.title=this.orig_title;\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\";\\\\n			comcodes[i].onmousedown=function(event) {\\\\n				if (typeof event=='undefined') var event=editor.window.\\\\\\\$.event;\\\\n\\\\n				if (event.altKey)\\\\n				{\\\\n					// Mouse cursor to start\\\\n					var range=document.selection.getRanges()[0];\\\\n					range.startOffset=0;\\\\n					range.endOffset=0;\\\\n					range.select()\\\\n					document.selection.selectRanges([range]);\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			if (comcodes[i].nodeName.toLowerCase()=='input')\\\\n			{\\\\n				comcodes[i].readOnly=true;\\\\n				comcodes[i].contentEditable=true; // Undoes what ckeditor sets. Fixes weirdness with copy and paste in Chrome (adding extra block on end)\\\\n				comcodes[i].ondblclick=function(event) {\\\\n					if (this.onmouseout) this.onmouseout();\\\\n					var field_name=editor.name;\\\\n					if ((typeof window.event!='undefined') && (window.event)) window.event.returnValue=false;\\\\n					if (this.id=='') this.id='comcode_tag_'+Math.round(Math.random()*10000000);\\\\n					var tag_type=this.title.replace(/^\\\\\\\\[/\\\",\\n	',',\\n	\\\"'').replace(/[= \\\\\\\\]].*\\\\\\\$/\\\",\\n	',',\\n	\\\"'');\\\\n					if (tag_type=='block')\\\\n					{\\\\n						var block_name=this.title.replace(/\\\\\\\\[\\\\\\\\/block\\\\\\\\]\\\\\\\$/\\\",\\n	',',\\n	\\\"'').replace(/^(.|\\\\\\\\s)*\\\\\\\\]/\\\",\\n	',',\\n	\\\"'');\\\\n						var url='\\\",\\n	ecv(\\\$cl,array(2),0,\\\"FIND_SCRIPT\\\",array(\\\"block_helper\\\")),\\n	\\\"?type=step2&block='+window.encodeURIComponent(block_name)+'&field_name='+field_name+'&parse_defaults='+window.encodeURIComponent(this.title)+'&save_to_id='+window.encodeURIComponent(this.id)+keep_stub();\\\\n						url=url+'&block_type='+(((field_name.indexOf('edit_panel_')==-1) && (window.location.href.indexOf(':panel_')==-1))?'main':'side');\\\\n						window.faux_open(maintain_theme_in_link(url)\\\",\\n	',',\\n	\\\"''\\\",\\n	',',\\n	\\\"'width=750\\\",\\n	',',\\n	\\\"height=520\\\",\\n	',',\\n	\\\"status=no\\\",\\n	',',\\n	\\\"resizable=yes\\\",\\n	',',\\n	\\\"scrollbars=yes'\\\",\\n	',',\\n	\\\"null\\\",\\n	',',\\n	\\\"'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"');\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n					{\\\\n						var url='\\\",\\n	ecv(\\\$cl,array(2),0,\\\"FIND_SCRIPT\\\",array(\\\"comcode_helper\\\")),\\n	\\\"?type=step2&tag='+window.encodeURIComponent(tag_type)+'&field_name='+field_name+'&parse_defaults='+window.encodeURIComponent(this.title)+'&save_to_id='+window.encodeURIComponent(this.id)+keep_stub();\\\\n						window.faux_open(maintain_theme_in_link(url)\\\",\\n	',',\\n	\\\"''\\\",\\n	',',\\n	\\\"'width=750\\\",\\n	',',\\n	\\\"height=520\\\",\\n	',',\\n	\\\"status=no\\\",\\n	',',\\n	\\\"resizable=yes\\\",\\n	',',\\n	\\\"scrollbars=yes'\\\",\\n	',',\\n	\\\"null\\\",\\n	',',\\n	\\\"'\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"INPUTSYSTEM_CANCEL\\\",array()),\\n	\\\"');\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n					return false;\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			comcodes[i].onmouseover=function(event) { // Shows preview\\\\n				if (typeof event=='undefined') var event=editor.window.\\\\\\\$.event;\\\\n\\\\n				cancel_bubbling(event);\\\\n\\\\n				if (typeof window.activate_tooltip!='undefined')\\\\n				{\\\\n					var tag_text='';\\\\n					if (this.nodeName.toLowerCase()=='input')\\\\n					{\\\\n						tag_text=this.orig_title;\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n					{\\\\n						tag_text=get_inner_html(this);\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n					//if (tag_text.match(/^\\\\\\\\[.*\\\\\\\\]\\\\\\\$/))\\\\n					{\\\\n						this.style.cursor='pointer';\\\\n\\\\n						var eventCopy={\\\",\\n	\\\"}\\\",\\n	\\\";\\\\n						if (event)\\\\n						{\\\\n							if (event.pageX) eventCopy.pageX=3000;\\\\n							if (event.clientX) eventCopy.clientX=3000;\\\\n							if (event.pageY) eventCopy.pageY=3000;\\\\n							if (event.clientY) eventCopy.clientY=3000;\\\\n\\\\n							var self_ob=this;\\\\n							if ((typeof this.rendered_tooltip=='undefined' && !self_ob.is_over) || (self_ob.tag_text!=tag_text))\\\\n							{\\\\n								self_ob.tag_text=tag_text;\\\\n								self_ob.is_over=true;\\\\n\\\\n								var url=maintain_theme_in_link('\\\",\\n	ecv(\\\$cl,array(2),0,\\\"FIND_SCRIPT_NOHTTP\\\",array(\\\"comcode_convert\\\")),\\n	\\\"?css=1&javascript=1&box_title=\\\",\\n	ecv(\\\$cl,array(2,6),2,\\\"PREVIEW\\\",array()),\\n	\\\"'+keep_stub());\\\\n								if (window.location.href.indexOf('topics')!=-1) url+='&forum_db=1';\\\\n								var request=do_ajax_request(url\\\",\\n	',',\\n	\\\"function(ajax_result_frame\\\",\\n	',',\\n	\\\"ajax_result) {\\\\n									if (ajax_result)\\\\n									{\\\\n										var tmp_rendered=merge_text_nodes(ajax_result.childNodes);\\\\n										if (tmp_rendered.indexOf('\\\",\\n	ecv(\\\$cl,array(2),2,\\\"CCP_ERROR_STUB\\\",array()),\\n	\\\"')==-1)\\\\n											self_ob.rendered_tooltip=tmp_rendered;\\\\n									\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n									if (typeof self_ob.rendered_tooltip!='undefined')\\\\n									{\\\\n										if (self_ob.is_over)\\\\n										{\\\\n											activate_tooltip(self_ob\\\",\\n	',',\\n	\\\"eventCopy\\\",\\n	',',\\n	\\\"self_ob.rendered_tooltip\\\",\\n	',',\\n	\\\"'auto'\\\",\\n	',',\\n	\\\"null\\\",\\n	',',\\n	\\\"null\\\",\\n	',',\\n	\\\"false\\\",\\n	',',\\n	\\\"true);\\\\n											self_ob.title=self_ob.orig_title;\\\\n										\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n									\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n								\\\",\\n	\\\"}\\\",\\n	',',\\n	\\\"'data='+window.encodeURIComponent('[semihtml]'+tag_text.replace(/<\\\\\\\\/?span[^>]*>/gi\\\",\\n	',',\\n	\\\"'')).substr(0\\\",\\n	',',\\n	\\\"1000).replace(new RegExp(String.fromCharCode(8203)\\\",\\n	',',\\n	\\\"'g')\\\",\\n	',',\\n	\\\"'')+'[/semihtml]');\\\\n							\\\",\\n	\\\"}\\\",\\n	\\\" else if (typeof this.rendered_tooltip!='undefined')\\\\n							{\\\\n								activate_tooltip(self_ob\\\",\\n	',',\\n	\\\"eventCopy\\\",\\n	',',\\n	\\\"self_ob.rendered_tooltip\\\",\\n	',',\\n	\\\"'400px'\\\",\\n	',',\\n	\\\"null\\\",\\n	',',\\n	\\\"null\\\",\\n	',',\\n	\\\"false\\\",\\n	',',\\n	\\\"true);\\\\n							\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n						\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\";\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n// ============\\\\n// BOTH EDITORS\\\\n// ============\\\\n\\\\nfunction is_comcode_xml(element)\\\\n{\\\\n	return (element.value.substr(0\\\",\\n	',',\\n	\\\"8)=='<comcode');\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction convert_xml(name)\\\\n{\\\\n	if (typeof window.do_ajax_request=='undefined') return false;\\\\n	if (typeof window.merge_text_nodes=='undefined') return false;\\\\n\\\\n	var element=document.getElementById(name);\\\\n\\\\n	if (is_wysiwyg_field(element))\\\\n	{\\\\n		window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"COMCODE_XML_CONVERT_NOT_WITH_WYSIWYG\\\",array()),\\n	\\\"');\\\\n		return false;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	var old_text=element.value;\\\\n	var url=maintain_theme_in_link('\\\",\\n	ecv(\\\$cl,array(2),0,\\\"FIND_SCRIPT_NOHTTP\\\",array(\\\"comcode_convert\\\")),\\n	\\\"?to_comcode_xml=1'+keep_stub());\\\\n	if (window.location.href.indexOf('topics')!=-1) url+='&forum_db=1';\\\\n	var request=do_ajax_request(url\\\",\\n	',',\\n	\\\"false\\\",\\n	',',\\n	\\\"'data='+window.encodeURIComponent(old_text).replace(new RegExp(String.fromCharCode(8203)\\\",\\n	',',\\n	\\\"'g')\\\",\\n	',',\\n	\\\"''));\\\\n	var result=((request) && (request.responseXML) && (request.responseXML.documentElement))?request.responseXML.documentElement.getElementsByTagName('result')[0]:null;\\\\n	if ((result) && (result.childNodes[0].data)) element.value=merge_text_nodes(result.childNodes);\\\\n	else\\\\n	{\\\\n		var error_window=window.open();\\\\n		error_window.document.write(request.responseText);\\\\n		error_window.document.close();\\\\n		window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"COMCODE_XML_CONVERT_PARSE_ERROR\\\",array()),\\n	\\\"');\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	return false;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction do_emoticon(field_name\\\",\\n	',',\\n	\\\"p\\\",\\n	',',\\n	\\\"_opener)\\\\n{\\\\n	var element;\\\\n	if (_opener)\\\\n	{\\\\n		element=get_main_ocp_window().document.getElementById(field_name);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n	{\\\\n		element=document.getElementById(field_name);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	element=ensure_true_id(element\\\",\\n	',',\\n	\\\"field_name);\\\\n\\\\n	var title=p.title;\\\\n	if (title=='') title=p.getElementsByTagName('img')[0].alt; // Might be on image inside link instead\\\\n	title=title.replace(/^.*: /\\\",\\n	',',\\n	\\\"'');\\\\n\\\\n	var text=is_comcode_xml(element)?('<emoticon>'+escape_html(title)+'</emoticon>'):(' '+title+' ');\\\\n\\\\n	if (_opener)\\\\n	{\\\\n		insert_textbox_opener(element\\\",\\n	',',\\n	\\\"text\\\",\\n	',',\\n	\\\"null\\\",\\n	',',\\n	\\\"true\\\",\\n	',',\\n	\\\"get_inner_html(p));\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n	{\\\\n		insert_textbox(element\\\",\\n	',',\\n	\\\"text\\\",\\n	',',\\n	\\\"null\\\",\\n	',',\\n	\\\"true\\\",\\n	',',\\n	\\\"get_inner_html(p));\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction do_attachment(field_name\\\",\\n	',',\\n	\\\"id\\\",\\n	',',\\n	\\\"description)\\\\n{\\\\n	if (!get_main_ocp_window().wysiwyg_editors) return;\\\\n\\\\n	if (typeof description=='undefined') var description='';\\\\n\\\\n	var element=get_main_ocp_window().document.getElementById(field_name);\\\\n	element=ensure_true_id(element\\\",\\n	',',\\n	\\\"field_name);\\\\n\\\\n	var comcode;\\\\n	if (!is_comcode_xml(element))\\\\n	{\\\\n		comcode='\\\\\\\\n\\\\\\\\n[attachment type=\\\\\\\"island\\\\\\\" description=\\\\\\\"'+escape_comcode(description)+'\\\\\\\"]'+id+'[/attachment]';\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n	{\\\\n		comcode='<br /><br /><attachment type=\\\\\\\"island\\\\\\\"><attachmentDescription>'+description+'</attachmentDescription>'+id+'</attachment>';\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	insert_textbox_opener(element\\\",\\n	',',\\n	\\\"comcode);\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction ensure_true_id(element\\\",\\n	',',\\n	\\\"field_name) // Works around IE bug\\\\n{\\\\n	var form=element.form;\\\\n	var i;\\\\n	for (i=0;i<form.elements.length;i++)\\\\n	{\\\\n		if ((form.elements[i].id==field_name)/* || (form.elements[i].name==field_name)*/)\\\\n		{\\\\n			return form.elements[i];\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	return element;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction is_wysiwyg_field(theElement)\\\\n{\\\\n	return ((typeof window.wysiwyg_editors!='undefined') && (typeof wysiwyg_editors[theElement.id]!='undefined'));\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction get_textbox(element)\\\\n{\\\\n	if (is_wysiwyg_field(element))\\\\n	{\\\\n		var ret=window.wysiwyg_editors[element.id].getData();\\\\n		if ((ret=='\\\\\\\\n') || (ret=='<br />')) ret='';\\\\n		return ret;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	return element.value;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction set_textbox(element\\\",\\n	',',\\n	\\\"text\\\",\\n	',',\\n	\\\"html)\\\\n{\\\\n	if (is_wysiwyg_field(element))\\\\n	{\\\\n		if (typeof html=='undefined') var html=escape_html(text).replace(new RegExp('\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\n'\\\",\\n	',',\\n	\\\"'gi')\\\",\\n	',',\\n	\\\"'<br />');\\\\n\\\\n		window.wysiwyg_editors[element.id].setData(html);\\\\n\\\\n		window.setTimeout(function() {\\\\n			find_tags_in_editor(window.wysiwyg_editors[element.id]\\\",\\n	',',\\n	\\\"element);\\\\n		\\\",\\n	\\\"}\\\",\\n	',',\\n	\\\" 100);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	element.value=text;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n/*\\\\nInsert some text\\\",\\n	',',\\n	\\\" with WYSIWYG support...\\\\n\\\\nelement: non-WYSIWYG element\\\\ntext: text to insert (non-HTML)\\\\nsel: Selection DOM object so we know what to *overwrite* with the inserted text (or NULL)\\\\nplain_insert: Set to true if we are doing a simple insert\\\",\\n	',',\\n	\\\" not inserting complex Comcode that needs to have editing representation\\\\nhtml: HTML to insert (if not passed then 'text' will be escaped)\\\\n\\\\n(Use insert_textbox_wrapping to wrap Comcode tags around a selection)\\\\n*/\\\\nfunction insert_textbox(element\\\",\\n	',',\\n	\\\"text\\\",\\n	',',\\n	\\\"sel\\\",\\n	',',\\n	\\\"plain_insert\\\",\\n	',',\\n	\\\"html)\\\\n{\\\\n	if (is_wysiwyg_field(element))\\\\n	{\\\\n		var editor=window.wysiwyg_editors[element.id];\\\\n\\\\n		var insert='';\\\\n		if (plain_insert)\\\\n		{\\\\n			insert=get_selected_html(editor)+(html?html:escape_html(text).replace(new RegExp('\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\n'\\\",\\n	',',\\n	\\\"'gi')\\\",\\n	',',\\n	\\\"'<br />'));\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n		{\\\\n			var is_block=text.match(/^\\\\\\\\s*\\\\\\\\[block(.*)\\\\\\\\](.*)\\\\\\\\[\\\\\\\\/block\\\\\\\\]\\\\\\\\s*\\\\\\\$/);\\\\n			var is_non_text_tag=false;\\\\n			var non_text_tags=['section_controller'\\\",\\n	',',\\n	\\\"'big_tab_controller'\\\",\\n	',',\\n	\\\"'img'\\\",\\n	',',\\n	\\\"'currency'\\\",\\n	',',\\n	\\\"'contents'\\\",\\n	',',\\n	\\\"'concepts'\\\",\\n	',',\\n	\\\"'attachment'\\\",\\n	',',\\n	\\\"'attachment_safe'\\\",\\n	',',\\n	\\\"'flash'\\\",\\n	',',\\n	\\\"'menu'\\\",\\n	',',\\n	\\\"'email'\\\",\\n	',',\\n	\\\"'reference'\\\",\\n	',',\\n	\\\"'upload'\\\",\\n	',',\\n	\\\"'page'\\\",\\n	',',\\n	\\\"'exp_thumb'\\\",\\n	',',\\n	\\\"'exp_ref'\\\",\\n	',',\\n	\\\"'thumb'\\\",\\n	',',\\n	\\\"'snapback'\\\",\\n	',',\\n	\\\"'post'\\\",\\n	',',\\n	\\\"'thread'\\\",\\n	',',\\n	\\\"'topic'\\\",\\n	',',\\n	\\\"'include'\\\",\\n	',',\\n	\\\"'random'\\\",\\n	',',\\n	\\\"'jumping'\\\",\\n	',',\\n	\\\"'shocker'];\\\\n			for (var i=0;i<non_text_tags.length;i++)\\\\n				is_non_text_tag=is_non_text_tag || text.match(new RegExp('^\\\\\\\\s*\\\\\\\\\\\\\\\\['+non_text_tags[i]+'([ =].*)?\\\\\\\\\\\\\\\\](.*)\\\\\\\\\\\\\\\\[\\\\\\\\/'+non_text_tags[i]+'\\\\\\\\\\\\\\\\]\\\\\\\\s*\\\\\\\$'));\\\\n			if (is_block || is_non_text_tag)\\\\n			{\\\\n				var button_text=is_block?'\\\",\\n	ecv(\\\$cl,array(2),2,\\\"comcode:COMCODE_EDITABLE_BLOCK\\\",array()),\\n	\\\"':'\\\",\\n	ecv(\\\$cl,array(2),2,\\\"comcode:COMCODE_EDITABLE_TAG\\\",array()),\\n	\\\"';\\\\n				var matches=text.match(/^\\\\\\\\s*\\\\\\\\[(\\\\\\\\w+)([ =].*)?\\\\\\\\](.*)\\\\\\\\[\\\\\\\\/\\\\\\\\w+\\\\\\\\]\\\\\\\\s*\\\\\\\$/);\\\\n				insert=get_selected_html(editor)+\\\\n					('<input class=\\\\\\\"ocp_keep_ui_controlled\\\\\\\" size=\\\\\\\"45\\\\\\\" title=\\\\\\\"'+(html?matches[0].replace(/^\\\\\\\\s*/\\\",\\n	',',\\n	\\\"'').replace(/\\\\\\\\s*\\\\\\\$/\\\",\\n	',',\\n	\\\"''):escape_html(matches[0].replace(/^\\\\\\\\s*/\\\",\\n	',',\\n	\\\"'').replace(/\\\\\\\\s*\\\\\\\$/\\\",\\n	',',\\n	\\\"'')))+'\\\\\\\" readonly=\\\\\\\"readonly\\\\\\\" type=\\\\\\\"text\\\\\\\" value=\\\\\\\"'+(button_text.replace(/^(main|side|bottom)\\\\\\\\_/\\\",\\n	',',\\n	\\\"'').replace('{1}'\\\",\\n	',',\\n	\\\"matches[is_block?3:1]))+'\\\\\\\" />');\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n			{\\\\n				var tag_name=text.replace(/^\\\\\\\\[/\\\",\\n	',',\\n	\\\"'').replace(/[ \\\\\\\\]].*\\\\\\\$/\\\",\\n	',',\\n	\\\"'');\\\\n				insert=get_selected_html(editor)+\\\\n					('&#8203;<kbd title=\\\\\\\"'+(html?tag_name:escape_html(tag_name))+'\\\\\\\" class=\\\\\\\"ocp_keep\\\\\\\">')+\\\\n					(html?html:escape_html(text).replace(new RegExp('\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\n'\\\",\\n	',',\\n	\\\"'gi')\\\",\\n	',',\\n	\\\"'<br />'))+\\\\n					'</kbd>&#8203;';\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n		var before=editor.getData();\\\\n\\\\n		try\\\\n		{\\\\n			if (!browser_matches('opera')) editor.focus(); // Needed on some browsers\\\",\\n	',',\\n	\\\" but on Opera will defocus our selection\\\\n			var selected_html=get_selected_html(editor);\\\\n			if (browser_matches('opera')) editor.getSelection().getNative().getRangeAt(0).deleteContents();\\\\n\\\\n			if ((editor.getSelection()) && (editor.getSelection().getStartElement().getName()=='kbd')) // Danger Danger - don't want to insert into another Comcode tag. Put it after. They can cut+paste back if they need.\\\\n			{\\\\n				editor.document.getBody().appendHtml(insert);\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n			{\\\\n				editor.insertHtml(insert);\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n			var after=editor.getData();\\\\n			if (after==before) throw 'Failed to insert';\\\\n\\\\n			find_tags_in_editor(editor\\\",\\n	',',\\n	\\\"element);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		catch (e) // Sometimes happens on Firefox in Windows\\\",\\n	',',\\n	\\\" appending is a bit tamer (e.g. you cannot insert if you have the start of a h1 at cursor)\\\\n		{\\\\n			var after=editor.getData();\\\\n			if (after==before) // Could have just been a window.scrollBy popup-blocker exception\\\",\\n	',',\\n	\\\" so only do this if the op definitely failed\\\\n				editor.document.getBody().appendHtml(insert);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		return;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	var from=element.value.length\\\",\\n	',',\\n	\\\"to;\\\\n\\\\n	element.focus();\\\\n\\\\n	if (typeof sel=='undefined') var sel=null;\\\\n	if (sel===null) sel=document.selection?document.selection:null;\\\\n\\\\n	if (typeof element.selectionEnd!='undefined') // Mozilla style\\\\n	{\\\\n		from=element.selectionStart;\\\\n		to=element.selectionEnd;\\\\n\\\\n		var start=element.value.substring(0\\\",\\n	',',\\n	\\\"from);\\\\n		var end=element.value.substring(to\\\",\\n	',',\\n	\\\"element.value.length);\\\\n\\\\n		element.value=start+element.value.substring(from\\\",\\n	',',\\n	\\\"to)+text+end;\\\\n		set_selection_range(element\\\",\\n	',',\\n	\\\"from+text.length\\\",\\n	',',\\n	\\\"from+text.length);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n	if (sel) // IE style\\\\n	{\\\\n		var ourRange=sel.createRange();\\\\n		if ((ourRange.moveToElementText) || (ourRange.parentElement()==element))\\\\n		{\\\\n			if (ourRange.parentElement()!=element) ourRange.moveToElementText(element);\\\\n			ourRange.text=ourRange.text+text;\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n		{\\\\n			element.value+=text;\\\\n			from+=2;\\\\n			set_selection_range(element\\\",\\n	',',\\n	\\\"from+text.length\\\",\\n	',',\\n	\\\"from+text.length);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	else\\\\n	{\\\\n		// :(\\\\n		from+=2;\\\\n		element.value+=text;\\\\n		set_selection_range(element\\\",\\n	',',\\n	\\\"from+text.length\\\",\\n	',',\\n	\\\"from+text.length);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\nfunction insert_textbox_opener(element\\\",\\n	',',\\n	\\\"text\\\",\\n	',',\\n	\\\"sel\\\",\\n	',',\\n	\\\"plain_insert\\\",\\n	',',\\n	\\\"html)\\\\n{\\\\n	if ((typeof sel=='undefined') || (!sel)) var sel=get_main_ocp_window().document.selection?get_main_ocp_window().document.selection:null;\\\\n\\\\n	get_main_ocp_window().insert_textbox(element\\\",\\n	',',\\n	\\\"text\\\",\\n	',',\\n	\\\"sel\\\",\\n	',',\\n	\\\"plain_insert\\\",\\n	',',\\n	\\\"html);\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n// Get selected HTML from CKEditor\\\\nfunction get_selected_html(editor)\\\\n{\\\\n	var my_selection=editor.getSelection();\\\\n	if (!my_selection || my_selection.getType()==window.CKEDITOR.SELECTION_NONE) return '';\\\\n\\\\n	var selected_text='';\\\\n	if (my_selection.getNative())\\\\n	{\\\\n		if ((window.CKEDITOR.env.ie) && (typeof my_selection.getNative().getRangeAt=='undefined')) // IE8 and under (selection object)\\\\n		{\\\\n			my_selection.unlock(true);\\\\n			selected_text=my_selection.getNative().createRange().htmlText;\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\" else // IE9 / standards (HTMLSelection object)\\\\n		{\\\\n			try\\\\n			{\\\\n				selected_text=get_inner_html(my_selection.getNative().getRangeAt(0).cloneContents());\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			catch (e) {\\\",\\n	\\\"}\\\",\\n	\\\";\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	return selected_text;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n// Insert into the editor such as to *wrap* the current selection with something new (typically a new Comcode tag)\\\\nfunction insert_textbox_wrapping(element\\\",\\n	',',\\n	\\\"before_wrap_tag\\\",\\n	',',\\n	\\\"after_wrap_tag)\\\\n{\\\\n	var from\\\",\\n	',',\\n	\\\"to;\\\\n\\\\n	if (after_wrap_tag=='')\\\\n	{\\\\n		if (!is_comcode_xml(element))\\\\n		{\\\\n			after_wrap_tag='[/'+before_wrap_tag+']';\\\\n			before_wrap_tag='['+before_wrap_tag+']';\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n		{\\\\n			after_wrap_tag='</'+before_wrap_tag+'>';\\\\n			before_wrap_tag='<'+before_wrap_tag+'>';\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	if (is_wysiwyg_field(element))\\\\n	{\\\\n		var editor=window.wysiwyg_editors[element.id];\\\\n\\\\n		if (!browser_matches('opera')) editor.focus(); // Needed on some browsers\\\",\\n	',',\\n	\\\" but on Opera will defocus our selection\\\\n		var selected_html=get_selected_html(editor);\\\\n		if (browser_matches('opera')) editor.getSelection().getNative().getRangeAt(0).deleteContents();\\\\n\\\\n		if (selected_html=='') selected_html='\\\",\\n	ecv(\\\$cl,array(2),2,\\\"comcode:TEXT_OR_COMCODE_GOES_HERE\\\",array()),\\n	\\\"'.toUpperCase();\\\\n\\\\n		var new_html='&#8203;<kbd title=\\\\\\\"'+escape_html(before_wrap_tag.replace(/^\\\\\\\\[/\\\",\\n	',',\\n	\\\"'').replace(/[ \\\\\\\\]].*\\\\\\\$/\\\",\\n	',',\\n	\\\"'').replace(/=.*\\\\\\\$/\\\",\\n	',',\\n	\\\"''))+'\\\\\\\" class=\\\\\\\"ocp_keep\\\\\\\">'+before_wrap_tag+selected_html+after_wrap_tag+'</kbd>&#8203;';\\\\n		if ((editor.getSelection()) && (editor.getSelection().getStartElement().getName()=='kbd')) // Danger Danger - don't want to insert into another Comcode tag. Put it after. They can cut+paste back if they need.\\\\n		{\\\\n			editor.document.getBody().appendHtml(new_html);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n		{\\\\n			editor.insertHtml(new_html);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n		find_tags_in_editor(editor\\\",\\n	',',\\n	\\\"element);\\\\n\\\\n		return;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	if (typeof element.selectionEnd!='undefined') // Mozilla style\\\\n	{\\\\n		from=element.selectionStart;\\\\n		to=element.selectionEnd;\\\\n\\\\n		var start=element.value.substring(0\\\",\\n	',',\\n	\\\"from);\\\\n		var end=element.value.substring(to\\\",\\n	',',\\n	\\\"element.value.length);\\\\n\\\\n		if (to>from)\\\\n		{\\\\n			element.value=start+before_wrap_tag+element.value.substring(from\\\",\\n	',',\\n	\\\"to)+after_wrap_tag+end;\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n		{\\\\n			element.value=start+before_wrap_tag+after_wrap_tag+end;\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		set_selection_range(element\\\",\\n	',',\\n	\\\"from\\\",\\n	',',\\n	\\\"to+before_wrap_tag.length+after_wrap_tag.length);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n	if (typeof document.selection!='undefined') // IE style\\\\n	{\\\\n		element.focus();\\\\n		var sel=document.selection;\\\\n		var ourRange=sel.createRange();\\\\n		if ((ourRange.moveToElementText) || (ourRange.parentElement()==element))\\\\n		{\\\\n			if (ourRange.parentElement()!=element) ourRange.moveToElementText(element);\\\\n			ourRange.text=before_wrap_tag+ourRange.text+after_wrap_tag;\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\" else element.value+=before_wrap_tag+after_wrap_tag;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	else\\\\n	{\\\\n		// :(\\\\n		element.value+=before_wrap_tag+after_wrap_tag;\\\\n		set_selection_range(element\\\",\\n	',',\\n	\\\"from\\\",\\n	',',\\n	\\\"to+before_wrap_tag.length+after_wrap_tag.length);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n// From http://www.faqts.com/knowledge_base/view.phtml/aid/13562\\\\nfunction set_selection_range(input\\\",\\n	',',\\n	\\\"selectionStart\\\",\\n	',',\\n	\\\"selectionEnd)\\\\n{\\\\n	if (typeof input.set_selection_range!='undefined') /* Mozilla style */\\\\n	{\\\\n		input.focus();\\\\n		input.set_selection_range(selectionStart\\\",\\n	',',\\n	\\\"selectionEnd);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	else if (typeof input.createTextRange!='undefined') /* IE style */\\\\n	{\\\\n		var range=input.createTextRange();\\\\n		range.collapse(true);\\\\n		range.moveEnd('character'\\\",\\n	',',\\n	\\\"selectionEnd);\\\\n		range.moveStart('character'\\\",\\n	',',\\n	\\\"selectionStart);\\\\n		range.select();\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" else input.focus();\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n\\\";\";\n\";}");

?>