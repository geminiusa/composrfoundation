<?php
return unserialize("a:6:{i:0;a:1:{i:0;a:5:{i:0;s:23:\"tcpfunc_JAVASCRIPT_AJAX\";i:1;a:0:{}i:2;i:1;i:3;s:0:\"\";i:4;s:0:\"\";}}i:1;a:0:{}i:2;s:15:\"JAVASCRIPT_AJAX\";i:3;N;i:4;N;i:5;s:13490:\"\$TPL_FUNCS['tcpfunc_JAVASCRIPT_AJAX']=\" echo \\\"\\\\\\\"use strict\\\\\\\";\\\\n\\\\nwindow.AJAX_REQUESTS=[];\\\\nwindow.AJAX_METHODS=[];\\\\n\\\\nwindow.block_data_cache={\\\",\\n	\\\"}\\\",\\n	\\\";\\\\n\\\\nfunction call_block(url\\\",\\n	',',\\n	\\\"new_params\\\",\\n	',',\\n	\\\"target_div\\\",\\n	',',\\n	\\\"append\\\",\\n	',',\\n	\\\"callback)\\\\n{\\\\n	if (typeof block_data_cache[url]=='undefined') block_data_cache[url]=get_inner_html(target_div); // Cache start position. For this to be useful we must be smart enough to pass blank new_params if returning to fresh state\\\\n\\\\n	var ajax_url=url+'&block_map_sup='+window.encodeURIComponent(new_params);\\\\n	if (typeof block_data_cache[ajax_url]!='undefined')\\\\n	{\\\\n		show_block_html(block_data_cache[ajax_url]\\\",\\n	',',\\n	\\\"target_div\\\",\\n	',',\\n	\\\"append);\\\\n		if (callback) callback();\\\\n		return null;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	// Show loading image\\\\n\\\\n	if (!append)\\\\n	{\\\\n		target_div.orig_position=target_div.style.position;\\\\n		target_div.style.position='relative';\\\\n		var loading_image=document.createElement('img');\\\\n		loading_image.src='\\\",\\n	ecv(\\\$cl,array(2),0,\\\"IMG\\\",array(\\\"loading\\\",\\\"0\\\",\\\"default\\\")),\\n	\\\"';\\\\n		loading_image.style.position='absolute';\\\\n		loading_image.style.left=(find_width(target_div)/2-10)+'px';\\\\n		loading_image.style.top=(find_height(target_div)/2-20)+'px';\\\\n		target_div.appendChild(loading_image);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	// Make AJAX call\\\\n	do_ajax_request(ajax_url\\\",\\n	',',\\n	\\\"function(raw_ajax_result) { _call_block(raw_ajax_result\\\",\\n	',',\\n	\\\"ajax_url\\\",\\n	',',\\n	\\\"target_div\\\",\\n	',',\\n	\\\"append\\\",\\n	',',\\n	\\\"callback); \\\",\\n	\\\"}\\\",\\n	\\\");\\\\n\\\\n	return false;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction _call_block(raw_ajax_result\\\",\\n	',',\\n	\\\"ajax_url\\\",\\n	',',\\n	\\\"target_div\\\",\\n	',',\\n	\\\"append\\\",\\n	',',\\n	\\\"callback)\\\\n{\\\\n	target_div.style.position=target_div.orig_position;\\\\n	var new_html=raw_ajax_result.responseText;\\\\n	block_data_cache[ajax_url]=new_html;\\\\n	show_block_html(new_html\\\",\\n	',',\\n	\\\"target_div\\\",\\n	',',\\n	\\\"append);\\\\n	if (callback) callback();\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction show_block_html(new_html\\\",\\n	',',\\n	\\\"target_div\\\",\\n	',',\\n	\\\"append)\\\\n{\\\\n	set_inner_html(target_div\\\",\\n	',',\\n	\\\"new_html\\\",\\n	',',\\n	\\\"append);\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction internalise_ajax_block_wrapper_links(url_stem\\\",\\n	',',\\n	\\\"block\\\",\\n	',',\\n	\\\"look_for\\\",\\n	',',\\n	\\\"extra_params)\\\\n{\\\\n	var _links=get_elements_by_class_name(block\\\",\\n	',',\\n	\\\"'ajax_block_wrapper_links');\\\\n	var links=[];\\\\n	for (var i=0;i<_links.length;i++)\\\\n	{\\\\n		var more_links=_links[i].getElementsByTagName('a');\\\\n		for (var j=0;j<more_links.length;j++)\\\\n		{\\\\n			links.push(more_links[j]);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	for (var i=0;i<links.length;i++)\\\\n	{\\\\n		links[i].href;\\\\n		links[i].onclick=function()\\\\n		{\\\\n			var url_stub='';\\\\n			for (var j=0;j<look_for.length;j++)\\\\n			{\\\\n				var matches=this.href.match(new RegExp('[&\\\\\\\\?]'+look_for[j]+'=([^&]*)'));\\\\n				if (matches)\\\\n				{\\\\n					url_stub+=(url_stem.indexOf('?')==-1)?'?':'&';\\\\n					url_stub+=look_for[j]+='='+matches[1];\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			for (var j in extra_params)\\\\n			{\\\\n				url_stub+=(url_stem.indexOf('?')==-1)?'?':'&';\\\\n				url_stub+=j+'='+window.encodeURIComponent(extra_params[j]);\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			return call_block(url_stem+url_stub\\\",\\n	',',\\n	\\\"''\\\",\\n	',',\\n	\\\"block\\\",\\n	',',\\n	\\\"false);\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n/* Calls up a URL to check something\\\",\\n	',',\\n	\\\" giving any 'feedback' as an error (or if just 'false' then returning false with no message) */\\\\nfunction do_ajax_field_test(url\\\",\\n	',',\\n	\\\"post)\\\\n{\\\\n	if (typeof window.keep_stub!='undefined') url=url+keep_stub();\\\\n	var xmlhttp=do_ajax_request(url\\\",\\n	',',\\n	\\\"null\\\",\\n	',',\\n	\\\"post);\\\\n	if ((xmlhttp.responseText!='') && (xmlhttp.responseText.replace(/[ \\\\\\\\t\\\\\\\\n\\\\\\\\r]/g\\\",\\n	',',\\n	\\\"'')!='0'/*some cache layers may change blank to zero*/))\\\\n	{\\\\n		if (xmlhttp.responseText!='false')\\\\n		{\\\\n			if (xmlhttp.responseText.length>1000)\\\\n			{\\\\n				var error_window=window.open();\\\\n				if (error_window)\\\\n				{\\\\n					error_window.document.write(xmlhttp.responseText);\\\\n					error_window.document.close();\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n			{\\\\n				window.fauxmodal_alert(xmlhttp.responseText);\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		return false;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	return true;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction ajax_form_submit(event\\\",\\n	',',\\n	\\\"form\\\",\\n	',',\\n	\\\"block_name\\\",\\n	',',\\n	\\\"map)\\\\n{\\\\n	if (typeof window.clever_find_value=='undefined') return true;\\\\n\\\\n	cancel_bubbling(event);\\\\n\\\\n	var comcode='[block'+map+']'+block_name+'[/block]';\\\\n	var post='data='+window.encodeURIComponent(comcode);\\\\n	for (var i=0;i<form.elements.length;i++)\\\\n	{\\\\n		post+='&'+form.elements[i].name+'='+window.encodeURIComponent(clever_find_value(form\\\",\\n	',',\\n	\\\"form.elements[i]));\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	var request=do_ajax_request(maintain_theme_in_link('\\\",\\n	ecv(\\\$cl,array(2),0,\\\"FIND_SCRIPT_NOHTTP\\\",array(\\\"comcode_convert\\\")),\\n	\\\"'+keep_stub(true))\\\",\\n	',',\\n	\\\"null\\\",\\n	',',\\n	\\\"post);\\\\n\\\\n	if ((request.responseText!='') && (request.responseText!=''))\\\\n	{\\\\n		if (request.responseText!='false')\\\\n		{\\\\n			var result_tags=request.responseXML.documentElement.getElementsByTagName('result');\\\\n			if ((result_tags) && (result_tags.length!=0))\\\\n			{\\\\n				var result=result_tags[0];\\\\n				var xhtml=merge_text_nodes(result.childNodes);\\\\n\\\\n				var element_replace=form;\\\\n				while (element_replace.className!='form_ajax_target')\\\\n				{\\\\n					element_replace=element_replace.parentNode;\\\\n					if (!element_replace) return true; // Oh dear\\\",\\n	',',\\n	\\\" target not found\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n				set_inner_html(element_replace\\\",\\n	',',\\n	\\\"xhtml);\\\\n\\\\n				window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2),2,\\\"SUCCESS\\\",array()),\\n	\\\"');\\\\n\\\\n				return false; // We've handled it internally\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	return true;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction do_ajax_request(url\\\",\\n	',',\\n	\\\"callback__method\\\",\\n	',',\\n	\\\"post) // Note: 'post' is not an array\\\",\\n	',',\\n	\\\" it's a string (a=b)\\\\n{\\\\n	var synchronous=!callback__method;\\\\n\\\\n	if ((url.indexOf('://')==-1) && (url.substr(0\\\",\\n	',',\\n	\\\"1)=='/'))\\\\n	{\\\\n		url=window.location.protocol+'//'+window.location.host+url;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	if ((typeof window.AJAX_REQUESTS=='undefined') || (!window.AJAX_REQUESTS)) return null; // Probably the page is in process of being navigated away so window object is gone\\\\n\\\\n	var index=window.AJAX_REQUESTS.length;\\\\n	window.AJAX_METHODS[index]=callback__method;\\\\n\\\\n	window.AJAX_REQUESTS[index]=new XMLHttpRequest();\\\\n	if (!synchronous) window.AJAX_REQUESTS[index].onreadystatechange=process_request_changes;\\\\n	if (post)\\\\n	{\\\\n		window.AJAX_REQUESTS[index].open('POST'\\\",\\n	',',\\n	\\\"url\\\",\\n	',',\\n	\\\"!synchronous);\\\\n		window.AJAX_REQUESTS[index].setRequestHeader('Content-Type'\\\",\\n	',',\\n	\\\"'application/x-www-form-urlencoded');\\\\n		window.AJAX_REQUESTS[index].send(post);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n	{\\\\n		window.AJAX_REQUESTS[index].open('GET'\\\",\\n	',',\\n	\\\"url\\\",\\n	',',\\n	\\\"!synchronous);\\\\n		window.AJAX_REQUESTS[index].send(null);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	if ((typeof window.AJAX_REQUESTS=='undefined') || (!window.AJAX_REQUESTS)) return null; // Probably the page is in process of being navigated away so window object is gone\\\\n	var result=window.AJAX_REQUESTS[index];\\\\n	if (synchronous)\\\\n	{\\\\n		window.AJAX_REQUESTS[index]=null;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	return result;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction process_request_changes()\\\\n{\\\\n	if ((typeof window.AJAX_REQUESTS=='undefined') || (!window.AJAX_REQUESTS)) return null; // Probably the page is in process of being navigated away so window object is gone\\\\n\\\\n	// If any AJAX_REQUESTS are 'complete'\\\\n	var i\\\",\\n	',',\\n	\\\"result;\\\\n	for (i=0;i<window.AJAX_REQUESTS.length;i++)\\\\n	{\\\\n		result=window.AJAX_REQUESTS[i];\\\\n		if ((result!=null) && (result.readyState) && (result.readyState==4))\\\\n		{\\\\n			window.AJAX_REQUESTS[i]=null;\\\\n\\\\n			// If status is 'OK'\\\\n			if ((result.status) && ((result.status==200) || (result.status==500) || (result.status==400) || (result.status==401)))\\\\n			{\\\\n				//Process the result\\\\n				if ((window.AJAX_METHODS[i]) && (!result.responseXML/*Not payload handler and not stack trace*/ || result.responseXML.childNodes.length==0))\\\\n				{\\\\n					return window.AJAX_METHODS[i](result);\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n				var xml=handle_errors_in_result(result);\\\\n				if (xml)\\\\n				{\\\\n					xml.validateOnParse=false;\\\\n					var ajax_result_frame=xml.documentElement;\\\\n					if (!ajax_result_frame) ajax_result_frame=xml;\\\\n					process_request_change(ajax_result_frame\\\",\\n	',',\\n	\\\"i);\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			else\\\\n			{\\\\n				try\\\\n				{\\\\n					if ((result.status==0) || (result.status==12029)) // 0 implies site down\\\",\\n	',',\\n	\\\" or network down\\\\n					{\\\\n						if ((!window.network_down) && (!window.unloaded))\\\\n						{\\\\n							if (result.status==12029) window.fauxmodal_alert('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"NETWORK_DOWN\\\",array()),\\n	\\\"');\\\\n							window.network_down=true;\\\\n						\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n					{\\\\n						if (typeof console.log!='undefined') console.log('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"PROBLEM_RETRIEVING_XML\\\",array()),\\n	\\\"\\\\\\\\n'+result.status+': '+result.statusText+'.');\\\\n					\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n				catch (e)\\\\n				{\\\\n					if (typeof console.log!='undefined') console.log('\\\",\\n	ecv(\\\$cl,array(2,8),2,\\\"PROBLEM_RETRIEVING_XML\\\",array()),\\n	\\\"');		// This is probably clicking back\\\\n				\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction handle_errors_in_result(result)\\\\n{\\\\n	if ((result.responseXML==null) || (result.responseXML.childNodes.length==0))\\\\n	{\\\\n		// Try and parse again. Firefox can be weird.\\\\n		var xml;\\\\n		if (typeof DOMParser!='undefined')\\\\n		{\\\\n			try { xml=(new DOMParser()).parseFromString(result.responseText\\\",\\n	',',\\n	\\\"'application/xml'); \\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			catch(e) {\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\" else\\\\n		{\\\\n			var ieDOM=['MSXML2.DOMDocument'\\\",\\n	',',\\n	\\\"'MSXML.DOMDocument'\\\",\\n	',',\\n	\\\"'Microsoft.XMLDOM'];\\\\n			for (var i=0;i<ieDOM.length && !xml;i++) {\\\\n				try { xml=new ActiveXObject(ieDOM[i]);xml.loadXML(result.responseText); \\\",\\n	\\\"}\\\",\\n	\\\"\\\\n				catch(e) {\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		if (xml) return xml;\\\\n\\\\n		if ((result.responseText) && (result.responseText!='') && (result.responseText.indexOf('<html')!=-1))\\\\n		{\\\\n			if (typeof console.debug!='undefined') console.debug(result);\\\\n\\\\n			var error_window=window.open();\\\\n			if (error_window)\\\\n			{\\\\n				error_window.document.write(result.responseText);\\\\n				error_window.document.close();\\\\n			\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n		return false;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	return result.responseXML;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction process_request_change(ajax_result_frame\\\",\\n	',',\\n	\\\"i)\\\\n{\\\\n	if (!ajax_result_frame) return null; // Needed for Opera\\\\n	if ((typeof window.AJAX_REQUESTS=='undefined') || (!window.AJAX_REQUESTS)) return null; // Probably the page is in process of being navigated away so window object is gone\\\\n\\\\n	if (ajax_result_frame.getElementsByTagName('message')[0])\\\\n	{\\\\n		//Either an error or a message was returned. :(\\\\n		var message=ajax_result_frame.getElementsByTagName('message')[0].firstChild.data;\\\\n\\\\n		if (ajax_result_frame.getElementsByTagName('error')[0])\\\\n		{\\\\n			//It's an error :|\\\\n			window.fauxmodal_alert('An error ('+ajax_result_frame.getElementsByTagName('error')[0].firstChild.data+') message was returned by the server: '+message);\\\\n			return null;\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n		window.fauxmodal_alert('An informational message was returned by the server: '+message);\\\\n		return null;\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n	var ajax_result=ajax_result_frame.getElementsByTagName('result')[0];\\\\n	if (!ajax_result) return null;\\\\n\\\\n	if ((ajax_result_frame.getElementsByTagName('method')[0]) || (window.AJAX_METHODS[i]))\\\\n	{\\\\n		var method=(ajax_result_frame.getElementsByTagName('method')[0])?eval('return '+merge_text_nodes(ajax_result_frame.getElementsByTagName('method')[0])):window.AJAX_METHODS[i];\\\\n		if (typeof method.response!='undefined') method.response(ajax_result_frame\\\",\\n	',',\\n	\\\"ajax_result);\\\\n		else method(ajax_result_frame\\\",\\n	',',\\n	\\\"ajax_result);\\\\n\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"// else window.fauxmodal_alert('Method required: as it is non-blocking');\\\\n\\\\n	return null;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction create_xml_doc()\\\\n{\\\\n	var xml_doc;\\\\n\\\\n	if (typeof window.ActiveXObject!='undefined')\\\\n	{\\\\n		xml_doc=new ActiveXObject('Microsoft.XMLDOM');\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	else if (document.implementation && document.implementation.createDocument)\\\\n	{\\\\n	  xml_doc=document.implementation.createDocument(''\\\",\\n	',',\\n	\\\"''\\\",\\n	',',\\n	\\\"null);\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	return xml_doc;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\nfunction merge_text_nodes(childNodes)\\\\n{\\\\n	var i\\\",\\n	',',\\n	\\\"text='';\\\\n	for (i=0;i<childNodes.length;i++)\\\\n	{\\\\n		if (childNodes[i].nodeName=='#text')\\\\n		{\\\\n			text+=childNodes[i].data;\\\\n		\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n	return text;\\\\n\\\",\\n	\\\"}\\\",\\n	\\\"\\\\n\\\\n\\\\n\\\";\";\n\";}");

?>